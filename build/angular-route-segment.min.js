/**
 * angular-route-segment 1.3.0
 * https://angular-route-segment.com
 * @author Artem Chivchalov
 * @license MIT License http://opensource.org/licenses/MIT
 */
"use strict";!function(a){var b=a.module("route-segment",[]);b.provider("$routeSegment",["$routeProvider","$locationProvider",function(b,c){function d(a){return a.replace(/([\:\-\_]+(.))/g,function(a,b,c,d){return d?c.toUpperCase():c})}function e(a,b){if(!a)throw new Error("Invalid pointer segment");var c;return{segment:function(b,e){return a[d(b)]={params:e},c=b,this},within:function(b){var f;if(b=b||c,f=a[d(b)])void 0==f.children&&(f.children={});else{if(g.strictMode)throw new Error("Cannot get into unknown `"+b+"` segment");f=a[d(b)]={params:{},children:{}}}return e(f.children,this)},up:function(){return b},root:function(){return i}}}var f=this,g=f.options={autoLoadTemplates:!0,strictMode:!1},h=this.segments={},i=e(h,null),j={};f.when=function(a,c){return b.when(a,{segment:c}),j[c]=a,this},a.extend(f,i),this.$get=["$rootScope","$q","$http","$templateCache","$route","$routeParams","$injector",function(b,e,f,i,k,l,m){function n(b){var c=!1;return b.params.dependencies&&a.forEach(b.params.dependencies,function(b){a.equals(t.$routeParams[b],l[b])||(c=!0)}),c}function o(a,b){return t.chain[a]&&t.chain[a].clearWatcher&&t.chain[a].clearWatcher(),b?(u[a]=b.name,b.params.untilResolved?p(a,b.name,b.params.untilResolved).then(function(c){return void 0!=c.success&&q(a),p(a,b.name,b.params)}):p(a,b.name,b.params)):(u[a]=null,void q(a))}function p(c,d,h){var j=a.extend({},h.resolve);return a.forEach(j,function(b,c){j[c]=a.isString(b)?m.get(b):m.invoke(b)}),h.template&&(j.$template=h.template,a.isFunction(j.$template)&&(j.$template=m.invoke(j.$template))),g.autoLoadTemplates&&h.templateUrl&&(j.$template=h.templateUrl,a.isFunction(j.$template)&&(j.$template=m.invoke(j.$template)),j.$template=f.get(j.$template,{cache:i}).then(function(a){return a.data})),e.all(j).then(function(f){if(u[c]!=d)return e.reject();if(t.chain[c]={name:d,params:h,locals:f,reload:function(){var a=r(c,t.name.split("."));o(c,a).then(function(a){void 0!=a.success&&q(c)})}},h.watcher){var g=function(){if(!a.isFunction(h.watcher))throw new Error("Watcher is not a function in segment `"+d+"`");return m.invoke(h.watcher,{},{segment:t.chain[c]})},i=g();t.chain[c].clearWatcher=b.$watch(g,function(a){a!=i&&(i=a,t.chain[c].reload())})}return{success:c}},function(b){if(h.resolveFailed){var f={error:function(){return e.when(b)}};return p(c,d,a.extend({resolve:f},h.resolveFailed))}throw new Error("Resolving failed with a reason `"+b+"`, but no `resolveFailed` provided for segment `"+d+"`")})}function q(c){t.$routeParams=a.copy(l),t.name="";for(var d=0;d<t.chain.length;d++)t.chain[d]&&(t.name+=t.chain[d].name+".");t.name=t.name.substr(0,t.name.length-1),b.$broadcast("routeSegmentChange",{index:c,segment:t.chain[c]||null})}function r(a,b){if(!b)return null;if(a>=b.length)return null;for(var c,e=h,f=0;a>=f;f++)c=b[f],void 0!=e[d(c)]&&(e=e[d(c)]),a>f&&(e=e.children);return{name:c,params:e.params,children:e.children}}var s=c.html5Mode()?"":c.hashPrefix(),t={name:"",$routeParams:a.copy(l),chain:[],startsWith:function(a){var b=new RegExp("^"+a);return b.test(t.name)},contains:function(a){for(var b=0;b<this.chain.length;b++)if(this.chain[b]&&this.chain[b].name==a)return!0;return!1},getSegmentUrl:function(b,c){var d,e,f;if(!j[b])throw new Error("Can not get URL for segment with name `"+b+"`");c=a.extend({},l,c||{}),d=j[b];for(e in c){var g=new RegExp(":"+e+"[*?]?","g");d=d.replace(g,c[e])}if(d=d.replace(/\/\:.*?\?/g,""),f=d.match(/\/\:([^\/]*)/))throw new Error("Route param `"+f[1]+"` is not specified for route `"+j[b]+"`");return s+d}},u={};return b.$on("$routeChangeSuccess",function(a,b){var c=b.$route||b.$$route;if(c&&c.segment){for(var d=c.segment,f=d.split("."),g=[],h=-1,i=0;i<f.length;i++){var j=r(i,f);(u[i]!=j.name||g.length>0||n(j))&&(t.chain[i]&&t.chain[i].name==j.name&&0==g.length&&!n(j)?u[i]=j.name:(g.push({index:i,newSegment:j}),h=i))}var k=e.when();if(g.length>0)for(var i=0;i<g.length;i++)!function(a){k=k.then(function(){return o(g[a].index,g[a].newSegment)}).then(function(b){if(void 0!=b.success){q(b.success);for(var c=g[a].index+1;c<t.chain.length;c++)t.chain[c]&&(t.chain[c]=null,o(c,null))}})}(i);k.then(function(){if(t.chain.length>f.length){var a=t.chain.length,b=t.chain.length-f.length;t.chain.splice(-b,b);for(var c=f.length;a>c;c++)o(c,null),h=t.chain.length-1}}).then(function(){var a=e.when();if(h==t.chain.length-1)for(var b=r(h,t.name.split("."));b;){var c=b.children,d=h+1;b=null;for(var f in c)!function(c,d,e){d[c].params.default&&(a=a.then(function(){return o(e,{name:c,params:d[c].params}).then(function(a){a.success&&q(a.success)})}),b=d[c],h=e)}(f,c,d)}return a})}}),t}]}]),b.filter("routeSegmentUrl",["$routeSegment",function(a){return function(b,c){return a.getSegmentUrl(b,c)}}]),b.filter("routeSegmentEqualsTo",["$routeSegment",function(a){return function(b){return a.name==b}}]),b.filter("routeSegmentStartsWith",["$routeSegment",function(a){return function(b){return a.startsWith(b)}}]),b.filter("routeSegmentContains",["$routeSegment",function(a){return function(b){return a.contains(b)}}]),b.filter("routeSegmentParam",["$routeSegment",function(a){return function(b){return a.$routeParams[b]}}])}(angular),function(a){a.module("view-segment",["route-segment"]).directive("appViewSegment",["$route","$compile","$controller","$routeParams","$routeSegment","$q","$injector","$timeout",function(b,c,d,e,f,g,h,i){return{restrict:"ECA",priority:500,compile:function(b,e){var g=b.html(),j=!0,k=a.element(document.createComment(" view-segment "));return b.prepend(k),function(l){function m(){p&&(r.leave(p),p=null),o&&(o.$destroy(),o=null)}function n(e){if(q=e,j&&(j=!1,b.replaceWith(k)),!e)return m(),p=b.clone(),p.html(g),r.enter(p,null,k),void c(p,!1,499)(l);var f=a.extend({},e.locals),h=f&&f.$template;m(),p=b.clone(),p.html(h?h:g),r.enter(p,null,k);var i,n=c(p,!1,499);o=l.$new(),e.params.controller&&(f.$scope=o,i=d(e.params.controller,f),e.params.controllerAs&&(o[e.params.controllerAs]=i),p.data("$ngControllerController",i),p.children().data("$ngControllerController",i)),n(o),o.$emit("$viewContentLoaded"),o.$eval(t)}var o,p,q,r,s,t=e.onload||"",u=parseInt(e.appViewSegment);try{var v=h.get("$animator");r=v(l,e)}catch(w){}try{r=h.get("$animate")}catch(w){}f.chain[u]&&(s=i(function(){n(f.chain[u])},0)),l.$on("routeSegmentChange",function(a,b){s&&i.cancel(s),b.index==u&&q!=b.segment&&n(b.segment)})}}}}])}(angular);